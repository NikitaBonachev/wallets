"use strict";var walletsApp=angular.module("walletsApp",["ui.router","userList","userTransactions","userDetail","templates"]);walletsApp.config(["$stateProvider","$locationProvider","$urlRouterProvider",function(e,t,r){e.state("user-list",{url:"/users",templateUrl:"controllers/user-list/UserListTemplate.html",controllerAs:"$ctrlUserList",controller:"UserListCtrl"}),e.state("user-detail",{url:"/user?id",templateUrl:"controllers/user-detail/UserDetailTemplate.html",controllerAs:"$ctrlDetail",controller:"UserDetailCtrl"}),e.state("user-transactions",{url:"/user/transactions?id",templateUrl:"controllers/user-transactions/UserTransactionsTemplate.html",controllerAs:"$ctrlUserTransactions",controller:"UserTransactionsCtrl"}),r.otherwise(function(e){e.get("$state").go("user-list")})}]),walletsApp.run(["$rootScope","$location",function(e,t){e.$on("$locationChangeSuccess",function(){e.currentUrl=t.url()})}]),angular.module("walletsAppConfig",[]).constant("appConfig",{baseUrl:"https://livedemo.xsolla.com/fe/test-task/baev",transDateTimeFormat:"YYYY-MM-DD HH:mm"}),angular.module("core-api",["walletsAppConfig"]),angular.module("core-api").factory("api",["$injector",function(e){var t=e.get("appConfig").baseUrl;return function(e){function r(e,t,r){return t&&r?e.then(function(e){t(e)},function(e){e(e)}):r?e.then(function(e){e(e)}):t?e.then(function(e){t(e)}):e}function a(a){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i="";if(n){i="?";for(var u in n)n.hasOwnProperty(u)&&(i+=u+"="+n[u]+"&");i=i.slice(0,-1)}return r(e.get(t+a+i),o,s)}function n(a,n,o,s){return n||(n={}),r(e.put(t+a,n),o,s)}function o(a,n,o,s){return r(e.post(t+a,n),o,s)}return{update:n,create:o,get:a}}}]),angular.module("newRecharge",["ui.router","core.user"]),angular.module("newRecharge").component("newRecharge",{templateUrl:"controllers/new-recharge/NewRechargeTemplate.html",controllerAs:"$ctrlNewRecharge",controller:["NewRecharge","$rootScope","$stateParams",function(e,t,r){var a=this;a.userId=r.id,a.newRecharge={amount:"",comment:""},a.submitRecharge=function(){if(a.errors=[],!a.newRecharge.comment)return void a.errors.push({message:"Comment should not be blank"});a.errors.length>0||(a.isLoading=!0,e(a.userId,a.newRecharge,function(e){a.isLoading=!1,e.data&&(e.data.amount?(t.$broadcast("newRecharge",{}),a.newRecharge={amount:"",comment:""}):a.errors.push({message:e.data.message}))},function(e){a.errors.push({message:e.message}),a.isLoading=!1}))}}]}),angular.module("transactionList",["ui.router","core.user"]),angular.module("transactionList").component("transactionList",{templateUrl:"controllers/transaction-list/TransactionListTemplate.html",controllerAs:"$ctrlTransList",controller:["UserTransactions","$stateParams","$injector",function(e,t,r){function a(){var t=o.params.datetime_to.format(),r=o.params.datetime_from.format(),a=o.params.trans_type,s={datetime_from:r,datetime_to:t};a&&(s.transaction_type=a),o.isLoading=!0,e(o.userId,s,function(e){o.isLoading=!1;var t=e.data;t.length?o.transactions=t.map(function(e){return e.dateFormated=moment(e.date).utc(!1).format(n),e}):o.transactions=[]},function(){o.isLoading=!1})}var n=r.get("appConfig").transDateTimeFormat,o=this;o.userId=t.id,o.params={datetime_from:moment().subtract(7,"days").startOf("day").utc(!1),datetime_to:moment().endOf("day").utc(!1),trans_type:null},o.types=[{name:"No selection"},{value:"payment",name:"Payment"},{value:"coupon",name:"Coupon"},{value:"inGamePurchase",name:"In game purchase"},{value:"internal",name:"Internal"},{value:"cancellation",name:"Cancellation"}],a(),angular.element(document).ready(function(){var e=$("#rangeStart"),t=$("#rangeEnd");e.calendar({type:"date",monthFirst:!1,firstDayOfWeek:1,endCalendar:t,onChange:function(e){o.params.datetime_from=moment(e).startOf("day").utc(!1)}}),t.calendar({type:"date",monthFirst:!1,firstDayOfWeek:1,startCalendar:e,onChange:function(e){o.params.datetime_to=moment(e).endOf("day").utc(!1)}}),$(".dropdown").dropdown()}),o.reloadTrans=function(){a()}}]}),angular.module("userDetail",["ui.router","userEdit","userInfo","newRecharge"]).controller("UserDetailCtrl",["$stateParams",function(e){var t=this;e.id&&(t.id=e.id)}]),angular.module("userEdit",["ui.router","core.user"]);var emailRegexp=new RegExp(["^","(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*",'|"(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21\\x23-\\x5b\\x5d-\\x7f]','|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])*")',"@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?","|\\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}","(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:","(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21-\\x5a\\x53-\\x7f]","|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])+)","\\])","$"].join(""));angular.module("userEdit").component("userEdit",{templateUrl:"controllers/user-edit/UserEditTemplate.html",controllerAs:"$ctrlEdit",controller:["CreateUser","UpdateUser","OneUser","$stateParams","$state",function(e,t,r,a,n){var o=this;o.user={user_id:"",user_name:"",user_custom:"",email:""},a.id&&(o.userId=a.id,o.isLoading=!0,r(o.userId,function(e){o.user=e.data,o.isLoading=!1},function(){o.isLoading=!1})),o.submitUser=function(r){o.errors=[],r.email.length>0&&(emailRegexp.test(r.email)||o.errors.push({message:"Invalid email"})),r.user_id||o.errors.push({message:"ID is required!"}),o.errors.length>0||(o.isLoading=!0,o.userId?t(o.userId,r,function(e){o.isLoading=!1,e.data&&204!=e.data.http_status_code&&o.errors.push({message:e.data.message})},function(e){o.errors.push({message:e.message}),o.isLoading=!1}):e(r,function(e){o.isLoading=!1,e.data?204!=e.data.http_status_code&&o.errors.push({message:e.data.message}):n.go("user-detail",{id:r.user_id})},function(e){o.errors.push({message:e.message}),o.isLoading=!1}))}}]}),angular.module("userInfo",["ui.router","core.user"]),angular.module("userInfo").component("userInfo",{templateUrl:"controllers/user-info/UserInfoTemplate.html",controllerAs:"$ctrlInfo",controller:["OneUser","$rootScope","$stateParams",function(e,t,r){function a(){n.isLoading=!0,e(n.userId,function(e){n.user=e.data,n.isLoading=!1},function(){n.isLoading=!1})}var n=this;n.user={},n.userId=r.id,a(),t.$on("newRecharge",function(){a()})}]}),angular.module("userList",["core.user"]).controller("UserListCtrl",["Users","$location","$injector",function(e,t,r){function a(e,t){for(var r=e,a=t,n=r-2,o=r+2+1,s=[],i=[],u=void 0,l=1;l<=a;l++)(1==l||l==a||l>=n&&l<o)&&s.push(l);var c=!0,d=!1,m=void 0;try{for(var g,f=s[Symbol.iterator]();!(c=(g=f.next()).done);c=!0){var p=g.value;u&&(p-u==2?i.push(u+1):p-u!=1&&i.push("...")),i.push(p),u=p}}catch(e){d=!0,m=e}finally{try{!c&&f.return&&f.return()}finally{if(d)throw m}}return i}function n(){o.isLoading=!0,e(o.pageParams,function(e){var t=o.pageParams.limit,r=o.pageParams.offset;o.users=e.data.data,o.isLoading=!1;var n=Math.ceil(e.data.recordsTotal/t),s=r/t+1;o.currentPage=s,o.pages=a(s,n)},function(){o.isLoading=!1})}var o=this;o.perPageChoices=[5,10,15],o.pages=[],o.pageParams={limit:o.perPageChoices[0],offset:0},n(),o.selectPerPage=function(e){o.pageParams.offset=0,o.pageParams.limit=e,n()},o.setPage=function(e){Number.isInteger(e)&&(o.pageParams.offset=e*o.pageParams.limit,n())},o.openUser=function(e){r.get("$state").go("user-detail",{id:e})}}]),angular.module("userTransactions",["ui.router","transactionList"]).controller("UserTransactionsCtrl",["$stateParams",function(e){this.id=e.id}]),angular.module("core.user",["core-api"]),angular.module("core.user").factory("Users",["api","$http",function(e,t){return function(r){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e(t).get("/users",r,a,n)}}]).factory("OneUser",["api","$http",function(e,t){return function(r){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e(t).get("/users/"+r,null,a,n)}}]).factory("UpdateUser",["api","$http",function(e,t){return function(r,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return e(t).update("/users/"+r,a,n,o)}}]).factory("CreateUser",["api","$http",function(e,t){return function(r){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e(t).create("/users",r,a,n)}}]).factory("NewRecharge",["api","$http",function(e,t){return function(r,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return e(t).create("/users/"+r+"/recharge",a,n,o)}}]).factory("UserTransactions",["api","$http",function(e,t){return function(r,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return e(t).get("/users/"+r+"/transactions",a,n,o)}}]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInNlcnZpY2VzL2NvcmUtYXBpLmpzIiwiY29uZmlnLmpzIiwiY29udHJvbGxlcnMvbmV3LXJlY2hhcmdlL05ld1JlY2hhcmdlQ3RybC5qcyIsImNvbnRyb2xsZXJzL3RyYW5zYWN0aW9uLWxpc3QvVHJhbnNhY3Rpb25MaXN0Q3RybC5qcyIsImNvbnRyb2xsZXJzL3VzZXItZGV0YWlsL1VzZXJEZXRhaWxDdHJsLmpzIiwiY29udHJvbGxlcnMvdXNlci1lZGl0L1VzZXJFZGl0Q3RybC5qcyIsImNvbnRyb2xsZXJzL3VzZXItaW5mby9Vc2VySW5mb0N0cmwuanMiLCJjb250cm9sbGVycy91c2VyLWxpc3QvVXNlckxpc3RDdHJsLmpzIiwiY29udHJvbGxlcnMvdXNlci10cmFuc2FjdGlvbnMvVXNlclRyYW5zYWN0aW9uc0N0cmwuanMiLCJzZXJ2aWNlcy91c2VyL3VzZXItc2VydmljZXMuanMiXSwibmFtZXMiOlsid2FsbGV0c0FwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCIkc3RhdGVQcm92aWRlciIsIiRsb2NhdGlvblByb3ZpZGVyIiwiJHVybFJvdXRlclByb3ZpZGVyIiwic3RhdGUiLCJ1cmwiLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXJBcyIsImNvbnRyb2xsZXIiLCJvdGhlcndpc2UiLCIkaW5qZWN0b3IiLCJnZXQiLCJnbyIsInJ1biIsIiRyb290U2NvcGUiLCIkb24iLCJjb25zdGFudCIsImJhc2VVcmwiLCJ0cmFuc0RhdGVUaW1lRm9ybWF0IiwiZmFjdG9yeSIsIiRodHRwIiwiYWRkQ2FsbGJhY2tzIiwicSIsInN1Y2Nlc3MiLCJlcnJvciIsInRoZW4iLCJyZXN1bHQiLCJwYXJhbXMiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJzdWNjZXNzQ2IiLCJlcnJvckNiIiwicGFyYW1zU3RyaW5nIiwia2V5IiwiaGFzT3duUHJvcGVydHkiLCJzbGljZSIsInVwZGF0ZSIsImRhdGEiLCJwdXQiLCJjcmVhdGUiLCJwb3N0IiwiY29tcG9uZW50IiwiTmV3UmVjaGFyZ2UiLCIkc3RhdGVQYXJhbXMiLCIkY3RybE5ld1JlY2hhcmdlIiwidGhpcyIsInVzZXJJZCIsImlkIiwibmV3UmVjaGFyZ2UiLCJhbW91bnQiLCJjb21tZW50Iiwic3VibWl0UmVjaGFyZ2UiLCJlcnJvcnMiLCJwdXNoIiwibWVzc2FnZSIsImlzTG9hZGluZyIsInJlc3BvbnNlIiwiJGJyb2FkY2FzdCIsIlVzZXJUcmFuc2FjdGlvbnMiLCJsb2FkVHJhbnNhY3Rpb25zIiwiZGF0ZXRpbWVfdG8iLCIkY3RybFRyYW5zTGlzdCIsImZvcm1hdCIsImRhdGV0aW1lX2Zyb20iLCJ0cmFuc190eXBlIiwidHJhbnNhY3Rpb25fdHlwZSIsInRyYW5zTGlzdCIsInRyYW5zYWN0aW9ucyIsIm1hcCIsInRyYW5zIiwiZGF0ZUZvcm1hdGVkIiwibW9tZW50IiwiZGF0ZSIsInV0YyIsImRhdGVUaW1lRm9ybWF0Iiwic3VidHJhY3QiLCJzdGFydE9mIiwiZW5kT2YiLCJ0eXBlcyIsIm5hbWUiLCJ2YWx1ZSIsImVsZW1lbnQiLCJkb2N1bWVudCIsInJlYWR5IiwicmFuZ2VTdGFydCIsIiQiLCJyYW5nZUVuZCIsImNhbGVuZGFyIiwidHlwZSIsIm1vbnRoRmlyc3QiLCJmaXJzdERheU9mV2VlayIsImVuZENhbGVuZGFyIiwib25DaGFuZ2UiLCJzdGFydENhbGVuZGFyIiwiZHJvcGRvd24iLCJyZWxvYWRUcmFucyIsIiRjdHJsRGV0YWlsIiwiZW1haWxSZWdleHAiLCJSZWdFeHAiLCJqb2luIiwiQ3JlYXRlVXNlciIsIlVwZGF0ZVVzZXIiLCJPbmVVc2VyIiwiJHN0YXRlIiwiJGN0cmxFZGl0IiwidXNlciIsInVzZXJfaWQiLCJ1c2VyX25hbWUiLCJ1c2VyX2N1c3RvbSIsImVtYWlsIiwic3VibWl0VXNlciIsInRlc3QiLCJodHRwX3N0YXR1c19jb2RlIiwibG9hZFVzZXIiLCIkY3RybEluZm8iLCJVc2VycyIsIiRsb2NhdGlvbiIsInBhZ2luYXRpb24iLCJjIiwibSIsImN1cnJlbnQiLCJsYXN0IiwibGVmdCIsInJpZ2h0IiwicmFuZ2UiLCJyYW5nZVdpdGhEb3RzIiwibCIsImkiLCJfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uIiwiX2RpZEl0ZXJhdG9yRXJyb3IiLCJfaXRlcmF0b3JFcnJvciIsIl9zdGVwIiwiX2l0ZXJhdG9yIiwiU3ltYm9sIiwiaXRlcmF0b3IiLCJuZXh0IiwiZG9uZSIsImVyciIsInJldHVybiIsImxvYWRVc2VycyIsIiRjdHJsVXNlckxpc3QiLCJwYWdlUGFyYW1zIiwicmVzcCIsInBhZ2VMaW1pdCIsImxpbWl0IiwicGFnZU9mZnNldCIsIm9mZnNldCIsInVzZXJzIiwidG90YWxQYWdlcyIsIk1hdGgiLCJjZWlsIiwicmVjb3Jkc1RvdGFsIiwiY3VycmVudFBhZ2UiLCJwYWdlcyIsInBlclBhZ2VDaG9pY2VzIiwic2VsZWN0UGVyUGFnZSIsInNldFBhZ2UiLCJwYWdlIiwiTnVtYmVyIiwiaXNJbnRlZ2VyIiwib3BlblVzZXIiLCJhcGkiXSwibWFwcGluZ3MiOiJBQUFBLFlBQUEsSUFBQUEsWUFBQUMsUUFBQUMsT0FBQSxjQUNBLFlBREEsV0FHQSxtQkFLQUYsYUFIQSxhQUdBQSxZQUNBRyxRQUFBQSxpQkFBQUEsb0JBQUFBLHFCQUNBLFNBQUFDLEVBQ0FDLEVBQ0FDLEdBRUFGLEVBQUFHLE1BQUEsYUFDQUMsSUFBQSxTQUNBQyxZQUFBLDhDQUNBQyxhQUFBLGdCQUNBQyxXQUFBLGlCQUdBUCxFQUFBRyxNQUFBLGVBQ0FDLElBQUEsV0FDQUMsWUFBQSxrREFDQUMsYUFBQSxjQUNBQyxXQUFBLG1CQUdBUCxFQUFBRyxNQUFBLHFCQUNBQyxJQUFBLHdCQUNBQyxZQUNBLDhEQUNBQyxhQUFBLHdCQVdBVixXQUFBQSx5QkFQQU0sRUFBQU0sVUFBQSxTQUFBQyxHQUNBQSxFQUFBQyxJQUFBLFVBQ0FDLEdBQUEsa0JBS0FmLFdBQUFnQixLQUNBLGFBQ0EsWUM3Q0FmLFNBQUFBLEVBQUFBLEdEK0NBZ0IsRUFBQUMsSUFBQSx5QkFBQSxXQ3hDQWpCLEVB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LEdBQUFBLFVBQUEsR0FBQSxLQUFBSSxFQUFBSixVQUFBQyxPQUFBLEdBQUFDLFNBQUFGLFVBQUEsR0FBQUEsVUFBQSxHQUFBLElBQ0EsT0FBQXNJLEdBQUE5SSxHQUFBVCxJQUNBLFVBQUFxQyxFQUFBLGdCQUNBckIsRUFDQUksRUFDQUMiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgd2FsbGV0c0FwcCA9IGFuZ3VsYXIubW9kdWxlKCd3YWxsZXRzQXBwJywgW1xuICAndWkucm91dGVyJyxcbiAgJ3VzZXJMaXN0JyxcbiAgJ3VzZXJUcmFuc2FjdGlvbnMnLFxuICAndXNlckRldGFpbCcsXG4gICd0ZW1wbGF0ZXMnXG5dKTtcblxud2FsbGV0c0FwcFxuICAuY29uZmlnKFxuICAgIGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlcixcbiAgICAgICAgICAgICAgJGxvY2F0aW9uUHJvdmlkZXIsXG4gICAgICAgICAgICAgICR1cmxSb3V0ZXJQcm92aWRlcikge1xuXG4gICAgICAkc3RhdGVQcm92aWRlci5zdGF0ZSgndXNlci1saXN0Jyx7XG4gICAgICAgIHVybDogJy91c2VycycsXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnY29udHJvbGxlcnMvdXNlci1saXN0L1VzZXJMaXN0VGVtcGxhdGUuaHRtbCcsXG4gICAgICAgIGNvbnRyb2xsZXJBczogJyRjdHJsVXNlckxpc3QnLFxuICAgICAgICBjb250cm9sbGVyOiAnVXNlckxpc3RDdHJsJ1xuICAgICAgfSk7XG5cbiAgICAgICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCd1c2VyLWRldGFpbCcsIHtcbiAgICAgICAgdXJsOiAnL3VzZXI/aWQnLFxuICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbnRyb2xsZXJzL3VzZXItZGV0YWlsL1VzZXJEZXRhaWxUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgY29udHJvbGxlckFzOiAnJGN0cmxEZXRhaWwnLFxuICAgICAgICBjb250cm9sbGVyOiAnVXNlckRldGFpbEN0cmwnXG4gICAgICB9KTtcblxuICAgICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ3VzZXItdHJhbnNhY3Rpb25zJyx7XG4gICAgICAgIHVybDogJy91c2VyL3RyYW5zYWN0aW9ucz9pZCcsXG4gICAgICAgIHRlbXBsYXRlVXJsOlxuICAgICAgICAgICdjb250cm9sbGVycy91c2VyLXRyYW5zYWN0aW9ucy9Vc2VyVHJhbnNhY3Rpb25zVGVtcGxhdGUuaHRtbCcsXG4gICAgICAgIGNvbnRyb2xsZXJBczogJyRjdHJsVXNlclRyYW5zYWN0aW9ucycsXG4gICAgICAgIGNvbnRyb2xsZXI6ICdVc2VyVHJhbnNhY3Rpb25zQ3RybCdcbiAgICAgIH0pO1xuXG4gICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKGZ1bmN0aW9uICgkaW5qZWN0b3IpIHtcbiAgICAgICAgY29uc3QgJHN0YXRlID0gJGluamVjdG9yLmdldCgnJHN0YXRlJyk7XG4gICAgICAgICRzdGF0ZS5nbygndXNlci1saXN0Jyk7XG4gICAgICB9KTtcbiAgICB9XG4gICk7XG5cbndhbGxldHNBcHAucnVuKFtcbiAgJyRyb290U2NvcGUnLFxuICAnJGxvY2F0aW9uJyxcbiAgKCRyb290U2NvcGUsICRsb2NhdGlvbikgPT4ge1xuICAgICRyb290U2NvcGUuJG9uKCckbG9jYXRpb25DaGFuZ2VTdWNjZXNzJywgZnVuY3Rpb24gKCkge1xuICAgICAgJHJvb3RTY29wZS5jdXJyZW50VXJsID0gJGxvY2F0aW9uLnVybCgpO1xuICAgIH0pO1xuICB9XG5dKTtcbiIsImFuZ3VsYXJcbiAgLm1vZHVsZShcbiAgICAnY29yZS1hcGknLCBbXG4gICAgICAnd2FsbGV0c0FwcENvbmZpZydcbiAgICBdXG4gICk7XG5cbmFuZ3VsYXJcbiAgLm1vZHVsZSgnY29yZS1hcGknKS5mYWN0b3J5KCdhcGknLCBbXG4gICckaW5qZWN0b3InLFxuICBmdW5jdGlvbiAoJGluamVjdG9yKSB7XG4gICAgY29uc3QgYmFzZVVybCA9ICRpbmplY3Rvci5nZXQoJ2FwcENvbmZpZycpLmJhc2VVcmw7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIGFwaSgkaHR0cCkge1xuICAgICAgLyoqXG4gICAgICAgKiBBZGQgY2FsbGJhY2tzXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHtQcm9taXNlfSBxXG4gICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzIGNhbGxiYWNrXG4gICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvciBjYWxsYmFja1xuICAgICAgICogQHJldHVybnMge1Byb21pc2V9XG4gICAgICAgKi9cbiAgICAgIGZ1bmN0aW9uIGFkZENhbGxiYWNrcyhxLCBzdWNjZXNzLCBlcnJvcikge1xuICAgICAgICBpZiAoc3VjY2VzcyAmJiBlcnJvcikge1xuICAgICAgICAgIHJldHVybiBxLnRoZW4oXG4gICAgICAgICAgICByZXN1bHQgPT4ge1xuICAgICAgICAgICAgICBzdWNjZXNzKHJlc3VsdCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgICAgICBlcnJvcihlcnJvcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICByZXR1cm4gcS50aGVuKFxuICAgICAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgICAgICBlcnJvcihlcnJvcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgIHJldHVybiBxLnRoZW4oXG4gICAgICAgICAgICByZXN1bHQgPT4ge1xuICAgICAgICAgICAgICBzdWNjZXNzKHJlc3VsdCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcTtcbiAgICAgIH1cblxuICAgICAgLyoqXG4gICAgICAgKiBRdWVyeSBmb3IgZ2V0IGxpc3RcbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsXG4gICAgICAgKiBAcGFyYW0ge29iamVjdH0gcGFyYW1zXG4gICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBzdWNjZXNzQ2JcbiAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGVycm9yQ2JcbiAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxuICAgICAgICovXG4gICAgICBmdW5jdGlvbiBnZXQodXJsLCBwYXJhbXMgPSBudWxsLCBzdWNjZXNzQ2IgPSBudWxsLCBlcnJvckNiID0gbnVsbCkge1xuICAgICAgICBsZXQgcGFyYW1zU3RyaW5nID0gJyc7XG4gICAgICAgIGlmIChwYXJhbXMpIHtcbiAgICAgICAgICBwYXJhbXNTdHJpbmcgPSAnPyc7XG4gICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gcGFyYW1zKSB7XG4gICAgICAgICAgICBpZiAocGFyYW1zLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgICAgICAgcGFyYW1zU3RyaW5nICs9IGtleSArICc9JyArIHBhcmFtc1trZXldICsgJyYnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBwYXJhbXNTdHJpbmcgPSBwYXJhbXNTdHJpbmcuc2xpY2UoMCwgLTEpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHEgPSAkaHR0cC5nZXQoYmFzZVVybCArIHVybCArIHBhcmFtc1N0cmluZyk7XG4gICAgICAgIHJldHVybiBhZGRDYWxsYmFja3MocSwgc3VjY2Vzc0NiLCBlcnJvckNiKTtcbiAgICAgIH1cblxuICAgICAgLyoqXG4gICAgICAgKiBVcGRhdGUgcmVxdWVzdFxuICAgICAgICpcbiAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmxcbiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG4gICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbc3VjY2Vzc0NiXVxuICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2Vycm9yQ2JdXG4gICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgICAqL1xuICAgICAgZnVuY3Rpb24gdXBkYXRlKHVybCwgZGF0YSwgc3VjY2Vzc0NiLCBlcnJvckNiKSB7XG4gICAgICAgIGlmICghZGF0YSkge1xuICAgICAgICAgIGRhdGEgPSB7fTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBxID0gJGh0dHAucHV0KGJhc2VVcmwgKyB1cmwsIGRhdGEpO1xuICAgICAgICByZXR1cm4gYWRkQ2FsbGJhY2tzKHEsIHN1Y2Nlc3NDYiwgZXJyb3JDYik7XG4gICAgICB9XG5cbiAgICAgIC8qKlxuICAgICAgICogQ3JlYXRlIHF1ZXJ5XG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHVybFxuICAgICAgICogQHBhcmFtIHtvYmplY3R9IGRhdGFcbiAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtzdWNjZXNzQ2JdXG4gICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbZXJyb3JDYl1cbiAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxuICAgICAgICovXG4gICAgICBmdW5jdGlvbiBjcmVhdGUodXJsLCBkYXRhLCBzdWNjZXNzQ2IsIGVycm9yQ2IpIHtcbiAgICAgICAgY29uc3QgcSA9ICRodHRwLnBvc3QoYmFzZVVybCArIHVybCwgZGF0YSk7XG4gICAgICAgIHJldHVybiBhZGRDYWxsYmFja3MocSwgc3VjY2Vzc0NiLCBlcnJvckNiKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdXBkYXRlOiB1cGRhdGUsXG4gICAgICAgIGNyZWF0ZTogY3JlYXRlLFxuICAgICAgICBnZXQ6IGdldFxuICAgICAgfTtcbiAgICB9O1xuICB9XG5dKTtcbiIsImNvbnN0IHdhbGxldHNBcHBDb25maWcgPSBhbmd1bGFyLm1vZHVsZSgnd2FsbGV0c0FwcENvbmZpZycsIFtdKTtcblxud2FsbGV0c0FwcENvbmZpZy5jb25zdGFudCgnYXBwQ29uZmlnJywge1xuICBiYXNlVXJsOiAnaHR0cHM6Ly9saXZlZGVtby54c29sbGEuY29tL2ZlL3Rlc3QtdGFzay9iYWV2JyxcbiAgdHJhbnNEYXRlVGltZUZvcm1hdDogJ1lZWVktTU0tREQgSEg6bW0nXG59KTtcbiIsImFuZ3VsYXIubW9kdWxlKCduZXdSZWNoYXJnZScsIFtcbiAgJ3VpLnJvdXRlcicsXG4gICdjb3JlLnVzZXInXG5dKTtcblxuYW5ndWxhclxuICAubW9kdWxlKCduZXdSZWNoYXJnZScpXG4gIC5jb21wb25lbnQoJ25ld1JlY2hhcmdlJywge1xuICAgIHRlbXBsYXRlVXJsOiAnY29udHJvbGxlcnMvbmV3LXJlY2hhcmdlL05ld1JlY2hhcmdlVGVtcGxhdGUuaHRtbCcsXG4gICAgY29udHJvbGxlckFzOiAnJGN0cmxOZXdSZWNoYXJnZScsXG4gICAgY29udHJvbGxlcjogW1xuICAgICAgJ05ld1JlY2hhcmdlJyxcbiAgICAgICckcm9vdFNjb3BlJyxcbiAgICAgICckc3RhdGVQYXJhbXMnLFxuICAgICAgZnVuY3Rpb24gKE5ld1JlY2hhcmdlLFxuICAgICAgICAgICAgICAgICRyb290U2NvcGUsXG4gICAgICAgICAgICAgICAgJHN0YXRlUGFyYW1zKSB7XG5cbiAgICAgICAgY29uc3QgJGN0cmxOZXdSZWNoYXJnZSA9IHRoaXM7XG5cbiAgICAgICAgJGN0cmxOZXdSZWNoYXJnZS51c2VySWQgPSAkc3RhdGVQYXJhbXMuaWQ7XG4gICAgICAgICRjdHJsTmV3UmVjaGFyZ2UubmV3UmVjaGFyZ2UgPSB7XG4gICAgICAgICAgYW1vdW50OiAnJyxcbiAgICAgICAgICBjb21tZW50OiAnJ1xuICAgICAgICB9O1xuXG4gICAgICAgICRjdHJsTmV3UmVjaGFyZ2Uuc3VibWl0UmVjaGFyZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgJGN0cmxOZXdSZWNoYXJnZS5lcnJvcnMgPSBbXTtcblxuICAgICAgICAgIGlmICghJGN0cmxOZXdSZWNoYXJnZS5uZXdSZWNoYXJnZS5jb21tZW50KSB7XG4gICAgICAgICAgICAkY3RybE5ld1JlY2hhcmdlXG4gICAgICAgICAgICAgIC5lcnJvcnNcbiAgICAgICAgICAgICAgLnB1c2goeyBtZXNzYWdlOiAnQ29tbWVudCBzaG91bGQgbm90IGJlIGJsYW5rJyB9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoJGN0cmxOZXdSZWNoYXJnZS5lcnJvcnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgICRjdHJsTmV3UmVjaGFyZ2UuaXNMb2FkaW5nID0gdHJ1ZTtcblxuICAgICAgICAgIE5ld1JlY2hhcmdlKFxuICAgICAgICAgICAgJGN0cmxOZXdSZWNoYXJnZS51c2VySWQsXG4gICAgICAgICAgICAkY3RybE5ld1JlY2hhcmdlLm5ld1JlY2hhcmdlLFxuICAgICAgICAgICAgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICRjdHJsTmV3UmVjaGFyZ2UuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5kYXRhLmFtb3VudCkge1xuICAgICAgICAgICAgICAgICAgJGN0cmxOZXdSZWNoYXJnZS5lcnJvcnMucHVzaChcbiAgICAgICAgICAgICAgICAgICAgeyBtZXNzYWdlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UgfVxuICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCduZXdSZWNoYXJnZScsIHt9KTtcbiAgICAgICAgICAgICAgICAgICRjdHJsTmV3UmVjaGFyZ2UubmV3UmVjaGFyZ2UgPSB7XG4gICAgICAgICAgICAgICAgICAgIGFtb3VudDogJycsXG4gICAgICAgICAgICAgICAgICAgIGNvbW1lbnQ6ICcnXG4gICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAkY3RybE5ld1JlY2hhcmdlLmVycm9ycy5wdXNoKHsgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB9KTtcbiAgICAgICAgICAgICAgJGN0cmxOZXdSZWNoYXJnZS5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuXG4gICAgICAgIH07XG5cbiAgICAgIH1cbiAgICBdXG4gIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3RyYW5zYWN0aW9uTGlzdCcsIFtcbiAgJ3VpLnJvdXRlcicsXG4gICdjb3JlLnVzZXInXG5dKTtcblxuYW5ndWxhclxuICAubW9kdWxlKCd0cmFuc2FjdGlvbkxpc3QnKVxuICAuY29tcG9uZW50KCd0cmFuc2FjdGlvbkxpc3QnLCB7XG4gICAgdGVtcGxhdGVVcmw6ICdjb250cm9sbGVycy90cmFuc2FjdGlvbi1saXN0L1RyYW5zYWN0aW9uTGlzdFRlbXBsYXRlLmh0bWwnLFxuICAgIGNvbnRyb2xsZXJBczogJyRjdHJsVHJhbnNMaXN0JyxcbiAgICBjb250cm9sbGVyOiBbXG4gICAgICAnVXNlclRyYW5zYWN0aW9ucycsXG4gICAgICAnJHN0YXRlUGFyYW1zJyxcbiAgICAgICckaW5qZWN0b3InLFxuICAgICAgZnVuY3Rpb24gKFxuICAgICAgICBVc2VyVHJhbnNhY3Rpb25zLFxuICAgICAgICAkc3RhdGVQYXJhbXMsXG4gICAgICAgICRpbmplY3Rvcikge1xuXG4gICAgICAgIGNvbnN0IGRhdGVUaW1lRm9ybWF0ID0gJGluamVjdG9yLmdldCgnYXBwQ29uZmlnJykudHJhbnNEYXRlVGltZUZvcm1hdDtcblxuICAgICAgICBjb25zdCAkY3RybFRyYW5zTGlzdCA9IHRoaXM7XG4gICAgICAgICRjdHJsVHJhbnNMaXN0LnVzZXJJZCA9ICRzdGF0ZVBhcmFtcy5pZDtcbiAgICAgICAgJGN0cmxUcmFuc0xpc3QucGFyYW1zID0gIHtcbiAgICAgICAgICBkYXRldGltZV9mcm9tOiBtb21lbnQoKS5zdWJ0cmFjdCg3LCAnZGF5cycpLnN0YXJ0T2YoJ2RheScpLnV0YyhmYWxzZSksXG4gICAgICAgICAgZGF0ZXRpbWVfdG86IG1vbWVudCgpLmVuZE9mKCdkYXknKS51dGMoZmFsc2UpLFxuICAgICAgICAgIHRyYW5zX3R5cGU6IG51bGxcbiAgICAgICAgfTtcblxuICAgICAgICAkY3RybFRyYW5zTGlzdC50eXBlcyA9IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiBcIk5vIHNlbGVjdGlvblwiXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB2YWx1ZTogXCJwYXltZW50XCIsXG4gICAgICAgICAgICBuYW1lOiBcIlBheW1lbnRcIlxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgdmFsdWU6IFwiY291cG9uXCIsXG4gICAgICAgICAgICBuYW1lOiBcIkNvdXBvblwiXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB2YWx1ZTogXCJpbkdhbWVQdXJjaGFzZVwiLFxuICAgICAgICAgICAgbmFtZTogXCJJbiBnYW1lIHB1cmNoYXNlXCJcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHZhbHVlOiBcImludGVybmFsXCIsXG4gICAgICAgICAgICBuYW1lOiBcIkludGVybmFsXCJcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHZhbHVlOiBcImNhbmNlbGxhdGlvblwiLFxuICAgICAgICAgICAgbmFtZTogXCJDYW5jZWxsYXRpb25cIlxuICAgICAgICAgIH1cbiAgICAgICAgXTtcblxuICAgICAgICBsb2FkVHJhbnNhY3Rpb25zKCk7XG5cbiAgICAgICAgLy8gSW5pdGlhbGl6ZSByYW5nZSBwaWNrZXJcbiAgICAgICAgYW5ndWxhci5lbGVtZW50KGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICBsZXQgcmFuZ2VTdGFydCA9ICQoJyNyYW5nZVN0YXJ0Jyk7XG4gICAgICAgICAgbGV0IHJhbmdlRW5kID0gJCgnI3JhbmdlRW5kJyk7XG5cbiAgICAgICAgICByYW5nZVN0YXJ0LmNhbGVuZGFyKHtcbiAgICAgICAgICAgIHR5cGU6ICdkYXRlJyxcbiAgICAgICAgICAgIG1vbnRoRmlyc3Q6IGZhbHNlLFxuICAgICAgICAgICAgZmlyc3REYXlPZldlZWs6IDEsXG4gICAgICAgICAgICBlbmRDYWxlbmRhcjogcmFuZ2VFbmQsXG4gICAgICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gKGRhdGUpIHtcbiAgICAgICAgICAgICAgJGN0cmxUcmFuc0xpc3QucGFyYW1zLmRhdGV0aW1lX2Zyb20gPSBtb21lbnQoZGF0ZSlcbiAgICAgICAgICAgICAgICAuc3RhcnRPZignZGF5JylcbiAgICAgICAgICAgICAgICAudXRjKGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICByYW5nZUVuZC5jYWxlbmRhcih7XG4gICAgICAgICAgICB0eXBlOiAnZGF0ZScsXG4gICAgICAgICAgICBtb250aEZpcnN0OiBmYWxzZSxcbiAgICAgICAgICAgIGZpcnN0RGF5T2ZXZWVrOiAxLFxuICAgICAgICAgICAgc3RhcnRDYWxlbmRhcjogcmFuZ2VTdGFydCxcbiAgICAgICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiAoZGF0ZSkge1xuICAgICAgICAgICAgICAkY3RybFRyYW5zTGlzdC5wYXJhbXMuZGF0ZXRpbWVfdG8gPSBtb21lbnQoZGF0ZSlcbiAgICAgICAgICAgICAgICAuZW5kT2YoJ2RheScpXG4gICAgICAgICAgICAgICAgLnV0YyhmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgJCgnLmRyb3Bkb3duJykuZHJvcGRvd24oKTtcblxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBDbGljayBvbiByZWZyZXNoIGJ1dHRvblxuICAgICAgICAkY3RybFRyYW5zTGlzdC5yZWxvYWRUcmFucyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBsb2FkVHJhbnNhY3Rpb25zKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gU3RhcnQgbG9hZGluZyB0cmFuc2FjdGlvbnNcbiAgICAgICAgZnVuY3Rpb24gbG9hZFRyYW5zYWN0aW9ucygpIHtcblxuICAgICAgICAgIGNvbnN0IGRhdGV0aW1lX3RvID0gJGN0cmxUcmFuc0xpc3QucGFyYW1zLmRhdGV0aW1lX3RvLmZvcm1hdCgpO1xuICAgICAgICAgIGNvbnN0IGRhdGV0aW1lX2Zyb20gPSAkY3RybFRyYW5zTGlzdC5wYXJhbXMuZGF0ZXRpbWVfZnJvbS5mb3JtYXQoKTtcbiAgICAgICAgICBjb25zdCB0cmFuc190eXBlID0gJGN0cmxUcmFuc0xpc3QucGFyYW1zLnRyYW5zX3R5cGU7XG5cbiAgICAgICAgICBjb25zdCBwYXJhbXMgPSB7XG4gICAgICAgICAgICBkYXRldGltZV9mcm9tLFxuICAgICAgICAgICAgZGF0ZXRpbWVfdG9cbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgaWYgKHRyYW5zX3R5cGUpIHtcbiAgICAgICAgICAgIHBhcmFtcy50cmFuc2FjdGlvbl90eXBlID0gdHJhbnNfdHlwZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAkY3RybFRyYW5zTGlzdC5pc0xvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgIFVzZXJUcmFuc2FjdGlvbnMoXG4gICAgICAgICAgICAkY3RybFRyYW5zTGlzdC51c2VySWQsXG4gICAgICAgICAgICBwYXJhbXMsXG4gICAgICAgICAgICBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgJGN0cmxUcmFuc0xpc3QuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgIGxldCB0cmFuc0xpc3QgPSByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICBpZiAodHJhbnNMaXN0Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICRjdHJsVHJhbnNMaXN0LnRyYW5zYWN0aW9ucyA9IHRyYW5zTGlzdC5tYXAoZnVuY3Rpb24gKHRyYW5zKSB7XG4gICAgICAgICAgICAgICAgICB0cmFucy5kYXRlRm9ybWF0ZWQgPSBtb21lbnQodHJhbnMuZGF0ZSlcbiAgICAgICAgICAgICAgICAgICAgLnV0YyhmYWxzZSlcbiAgICAgICAgICAgICAgICAgICAgLmZvcm1hdChkYXRlVGltZUZvcm1hdCk7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gdHJhbnM7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJGN0cmxUcmFuc0xpc3QudHJhbnNhY3Rpb25zID0gW107XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICRjdHJsVHJhbnNMaXN0LmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgfVxuXG4gICAgXVxuXG59KTtcbiIsImNvbnN0IHVzZXJEZXRhaWxDdHJsID0gYW5ndWxhci5tb2R1bGUoJ3VzZXJEZXRhaWwnLCBbXG4gICd1aS5yb3V0ZXInLFxuICAndXNlckVkaXQnLFxuICAndXNlckluZm8nLFxuICAnbmV3UmVjaGFyZ2UnXG5dKTtcblxudXNlckRldGFpbEN0cmwuY29udHJvbGxlcignVXNlckRldGFpbEN0cmwnLCBbXG4gICckc3RhdGVQYXJhbXMnLFxuICBmdW5jdGlvbiAoJHN0YXRlUGFyYW1zKSB7XG4gICAgY29uc3QgJGN0cmxEZXRhaWwgPSB0aGlzO1xuICAgIGlmICgkc3RhdGVQYXJhbXMuaWQpIHtcbiAgICAgICRjdHJsRGV0YWlsLmlkID0gJHN0YXRlUGFyYW1zLmlkO1xuICAgIH1cbiAgfVxuXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgndXNlckVkaXQnLCBbXG4gICd1aS5yb3V0ZXInLFxuICAnY29yZS51c2VyJ1xuXSk7XG5cbmNvbnN0IGVtYWlsUmVnZXhwID0gbmV3IFJlZ0V4cChcbiAgW1xuICAgICdeJyxcbiAgICAnKD86W2EtejAtOSEjJCUmXFwnKisvPT9eX2B7fH1+LV0rKD86XFxcXC5bYS16MC05ISMkJSZcXCcqKy89P15fYHt8fX4tXSspKicsXG4gICAgJ3xcIig/OltcXFxceDAxLVxcXFx4MDhcXFxceDBiXFxcXHgwY1xcXFx4MGUtXFxcXHgxZlxcXFx4MjFcXFxceDIzLVxcXFx4NWJcXFxceDVkLVxcXFx4N2ZdJyxcbiAgICAnfFxcXFxcXFxcW1xcXFx4MDEtXFxcXHgwOVxcXFx4MGJcXFxceDBjXFxcXHgwZS1cXFxceDdmXSkqXCIpJyxcbiAgICAnQCg/Oig/OlthLXowLTldKD86W2EtejAtOS1dKlthLXowLTldKT9cXFxcLikrW2EtejAtOV0oPzpbYS16MC05LV0qW2EtejAtOV0pPycsXG4gICAgJ3xcXFxcWyg/Oig/OjI1WzAtNV18MlswLTRdWzAtOV18WzAxXT9bMC05XVswLTldPylcXFxcLil7M30nLFxuICAgICcoPzoyNVswLTVdfDJbMC00XVswLTldfFswMV0/WzAtOV1bMC05XT98W2EtejAtOS1dKlthLXowLTldOicsXG4gICAgJyg/OltcXFxceDAxLVxcXFx4MDhcXFxceDBiXFxcXHgwY1xcXFx4MGUtXFxcXHgxZlxcXFx4MjEtXFxcXHg1YVxcXFx4NTMtXFxcXHg3Zl0nLFxuICAgICd8XFxcXFxcXFxbXFxcXHgwMS1cXFxceDA5XFxcXHgwYlxcXFx4MGNcXFxceDBlLVxcXFx4N2ZdKSspJyxcbiAgICAnXFxcXF0pJyxcbiAgICAnJCdcbiAgXS5qb2luKCcnKVxuKTtcblxuYW5ndWxhclxuICAubW9kdWxlKCd1c2VyRWRpdCcpXG4gIC5jb21wb25lbnQoJ3VzZXJFZGl0Jywge1xuICAgIHRlbXBsYXRlVXJsOiAnY29udHJvbGxlcnMvdXNlci1lZGl0L1VzZXJFZGl0VGVtcGxhdGUuaHRtbCcsXG4gICAgY29udHJvbGxlckFzOiAnJGN0cmxFZGl0JyxcbiAgICBjb250cm9sbGVyOiBbXG4gICAgICAnQ3JlYXRlVXNlcicsXG4gICAgICAnVXBkYXRlVXNlcicsXG4gICAgICAnT25lVXNlcicsXG4gICAgICAnJHN0YXRlUGFyYW1zJyxcbiAgICAgICckc3RhdGUnLFxuICAgICAgZnVuY3Rpb24gKFxuICAgICAgICBDcmVhdGVVc2VyLFxuICAgICAgICBVcGRhdGVVc2VyLFxuICAgICAgICBPbmVVc2VyLFxuICAgICAgICAkc3RhdGVQYXJhbXMsXG4gICAgICAgICRzdGF0ZSkge1xuICAgICAgICBjb25zdCAkY3RybEVkaXQgPSB0aGlzO1xuXG4gICAgICAgICRjdHJsRWRpdC51c2VyID0ge1xuICAgICAgICAgIHVzZXJfaWQ6ICcnLFxuICAgICAgICAgIHVzZXJfbmFtZTogJycsXG4gICAgICAgICAgdXNlcl9jdXN0b206ICcnLFxuICAgICAgICAgIGVtYWlsOiAnJ1xuICAgICAgICB9O1xuXG4gICAgICAgIGlmICgkc3RhdGVQYXJhbXMuaWQpIHtcbiAgICAgICAgICAkY3RybEVkaXQudXNlcklkID0gJHN0YXRlUGFyYW1zLmlkO1xuICAgICAgICAgICRjdHJsRWRpdC5pc0xvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgIE9uZVVzZXIoXG4gICAgICAgICAgICAkY3RybEVkaXQudXNlcklkLFxuICAgICAgICAgICAgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICRjdHJsRWRpdC51c2VyID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgICAgJGN0cmxFZGl0LmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgJGN0cmxFZGl0LmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICAkY3RybEVkaXQuc3VibWl0VXNlciA9IGZ1bmN0aW9uICh1c2VyKSB7XG4gICAgICAgICAgJGN0cmxFZGl0LmVycm9ycyA9IFtdO1xuICAgICAgICAgIGlmICh1c2VyLmVtYWlsLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGlmICghZW1haWxSZWdleHAudGVzdCh1c2VyLmVtYWlsKSkge1xuICAgICAgICAgICAgICAkY3RybEVkaXQuZXJyb3JzLnB1c2goe21lc3NhZ2U6ICdJbnZhbGlkIGVtYWlsJ30pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoIXVzZXIudXNlcl9pZCkge1xuICAgICAgICAgICAgJGN0cmxFZGl0LmVycm9ycy5wdXNoKHttZXNzYWdlOiAnSUQgaXMgcmVxdWlyZWQhJ30pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmICgkY3RybEVkaXQuZXJyb3JzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAkY3RybEVkaXQuaXNMb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICBpZiAoISRjdHJsRWRpdC51c2VySWQpIHtcbiAgICAgICAgICAgIENyZWF0ZVVzZXIoXG4gICAgICAgICAgICAgIHVzZXIsXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICRjdHJsRWRpdC5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSkge1xuICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuaHR0cF9zdGF0dXNfY29kZSAhPSAyMDQpIHtcbiAgICAgICAgICAgICAgICAgICAgJGN0cmxFZGl0LmVycm9ycy5wdXNoKHttZXNzYWdlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2V9KTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCd1c2VyLWRldGFpbCcsIHsgaWQ6IHVzZXIudXNlcl9pZCB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICRjdHJsRWRpdC5lcnJvcnMucHVzaCh7bWVzc2FnZTogZXJyb3IubWVzc2FnZX0pO1xuICAgICAgICAgICAgICAgICRjdHJsRWRpdC5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgVXBkYXRlVXNlcihcbiAgICAgICAgICAgICAgJGN0cmxFZGl0LnVzZXJJZCxcbiAgICAgICAgICAgICAgdXNlcixcbiAgICAgICAgICAgICAgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgJGN0cmxFZGl0LmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhKSB7XG4gICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5odHRwX3N0YXR1c19jb2RlICE9IDIwNCkge1xuICAgICAgICAgICAgICAgICAgICAkY3RybEVkaXQuZXJyb3JzLnB1c2goe21lc3NhZ2U6IHJlc3BvbnNlLmRhdGEubWVzc2FnZX0pO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgJGN0cmxFZGl0LmVycm9ycy5wdXNoKHttZXNzYWdlOiBlcnJvci5tZXNzYWdlfSk7XG4gICAgICAgICAgICAgICAgJGN0cmxFZGl0LmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cblxuICAgICAgICB9O1xuICAgICAgfVxuICAgIF1cbiAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgndXNlckluZm8nLCBbXG4gICd1aS5yb3V0ZXInLFxuICAnY29yZS51c2VyJ1xuXSk7XG5cbmFuZ3VsYXJcbiAgLm1vZHVsZSgndXNlckluZm8nKVxuICAuY29tcG9uZW50KCd1c2VySW5mbycsIHtcbiAgICB0ZW1wbGF0ZVVybDogJ2NvbnRyb2xsZXJzL3VzZXItaW5mby9Vc2VySW5mb1RlbXBsYXRlLmh0bWwnLFxuICAgIGNvbnRyb2xsZXJBczogJyRjdHJsSW5mbycsXG4gICAgY29udHJvbGxlcjogW1xuICAgICAgJ09uZVVzZXInLFxuICAgICAgJyRyb290U2NvcGUnLFxuICAgICAgJyRzdGF0ZVBhcmFtcycsXG4gICAgICBmdW5jdGlvbiAoT25lVXNlcixcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLFxuICAgICAgICAgICAgICAgICRzdGF0ZVBhcmFtcykge1xuXG4gICAgICAgIGNvbnN0ICRjdHJsSW5mbyA9IHRoaXM7XG5cbiAgICAgICAgJGN0cmxJbmZvLnVzZXIgPSB7fTtcblxuICAgICAgICAkY3RybEluZm8udXNlcklkID0gJHN0YXRlUGFyYW1zLmlkO1xuICAgICAgICBsb2FkVXNlcigpO1xuXG4gICAgICAgICRyb290U2NvcGUuJG9uKCduZXdSZWNoYXJnZScsICgpID0+IHtcbiAgICAgICAgICBsb2FkVXNlcigpO1xuICAgICAgICB9KTtcblxuICAgICAgICBmdW5jdGlvbiBsb2FkVXNlcigpIHtcbiAgICAgICAgICAkY3RybEluZm8uaXNMb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICBPbmVVc2VyKFxuICAgICAgICAgICAgJGN0cmxJbmZvLnVzZXJJZCxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAkY3RybEluZm8udXNlciA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICAgICRjdHJsSW5mby5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICRjdHJsSW5mby5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgIH1cbiAgICBdXG4gIH0pO1xuIiwiY29uc3QgdXNlckxpc3RDdHJsID0gYW5ndWxhci5tb2R1bGUoJ3VzZXJMaXN0JywgWydjb3JlLnVzZXInXSk7XG5cbnVzZXJMaXN0Q3RybC5jb250cm9sbGVyKCdVc2VyTGlzdEN0cmwnLCBbXG4gICdVc2VycycsXG4gICckbG9jYXRpb24nLFxuICAnJGluamVjdG9yJyxcbiAgZnVuY3Rpb24gKFVzZXJzLCAkbG9jYXRpb24sICRpbmplY3Rvcikge1xuICAgIGNvbnN0ICRjdHJsVXNlckxpc3QgPSB0aGlzO1xuICAgICRjdHJsVXNlckxpc3QucGVyUGFnZUNob2ljZXMgPSBbNSwgMTAsIDE1XTtcbiAgICAkY3RybFVzZXJMaXN0LnBhZ2VzID0gW107XG4gICAgJGN0cmxVc2VyTGlzdC5wYWdlUGFyYW1zID0ge1xuICAgICAgbGltaXQ6ICRjdHJsVXNlckxpc3QucGVyUGFnZUNob2ljZXNbMF0sXG4gICAgICBvZmZzZXQ6IDBcbiAgICB9O1xuXG4gICAgbG9hZFVzZXJzKCk7XG5cbiAgICAkY3RybFVzZXJMaXN0LnNlbGVjdFBlclBhZ2UgPSBmdW5jdGlvbiAobGltaXQpIHtcbiAgICAgICRjdHJsVXNlckxpc3QucGFnZVBhcmFtcy5vZmZzZXQgPSAwO1xuICAgICAgJGN0cmxVc2VyTGlzdC5wYWdlUGFyYW1zLmxpbWl0ID0gbGltaXQ7XG4gICAgICBsb2FkVXNlcnMoKTtcbiAgICB9O1xuXG4gICAgJGN0cmxVc2VyTGlzdC5zZXRQYWdlID0gZnVuY3Rpb24gKHBhZ2UpIHtcbiAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihwYWdlKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICAkY3RybFVzZXJMaXN0LnBhZ2VQYXJhbXMub2Zmc2V0ID0gcGFnZSAqICRjdHJsVXNlckxpc3QucGFnZVBhcmFtcy5saW1pdDtcbiAgICAgIGxvYWRVc2VycygpO1xuICAgIH07XG5cbiAgICAkY3RybFVzZXJMaXN0Lm9wZW5Vc2VyID0gZnVuY3Rpb24gKHVzZXJJZCkge1xuICAgICAgY29uc3QgJHN0YXRlID0gJGluamVjdG9yLmdldCgnJHN0YXRlJyk7XG4gICAgICAkc3RhdGUuZ28oJ3VzZXItZGV0YWlsJywgeyBpZDogdXNlcklkIH0pO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqIEBwYXJhbSBjIC0gY3VycmVudCBwYWdlXG4gICAgICogQHBhcmFtIG0gLSB0b3RhbCBwYWdlcyBjb3VudFxuICAgICAqIEByZXR1cm5zIHtBcnJheX1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBwYWdpbmF0aW9uKGMsIG0pIHtcbiAgICAgIGxldCBjdXJyZW50ID0gYyxcbiAgICAgICAgbGFzdCA9IG0sXG4gICAgICAgIGRlbHRhID0gMixcbiAgICAgICAgbGVmdCA9IGN1cnJlbnQgLSBkZWx0YSxcbiAgICAgICAgcmlnaHQgPSBjdXJyZW50ICsgZGVsdGEgKyAxLFxuICAgICAgICByYW5nZSA9IFtdLFxuICAgICAgICByYW5nZVdpdGhEb3RzID0gW10sXG4gICAgICAgIGw7XG5cbiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IGxhc3Q7IGkrKykge1xuICAgICAgICBpZiAoaSA9PSAxIHx8IGkgPT0gbGFzdCB8fCBpID49IGxlZnQgJiYgaSA8IHJpZ2h0KSB7XG4gICAgICAgICAgcmFuZ2UucHVzaChpKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBmb3IgKGxldCBpIG9mIHJhbmdlKSB7XG4gICAgICAgIGlmIChsKSB7XG4gICAgICAgICAgaWYgKGkgLSBsID09PSAyKSB7XG4gICAgICAgICAgICByYW5nZVdpdGhEb3RzLnB1c2gobCArIDEpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoaSAtIGwgIT09IDEpIHtcbiAgICAgICAgICAgIHJhbmdlV2l0aERvdHMucHVzaCgnLi4uJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJhbmdlV2l0aERvdHMucHVzaChpKTtcbiAgICAgICAgbCA9IGk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByYW5nZVdpdGhEb3RzO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGxvYWRVc2VycygpIHtcbiAgICAgICRjdHJsVXNlckxpc3QuaXNMb2FkaW5nID0gdHJ1ZTtcbiAgICAgIFVzZXJzKFxuICAgICAgICAkY3RybFVzZXJMaXN0LnBhZ2VQYXJhbXMsXG4gICAgICAgIGZ1bmN0aW9uIChyZXNwKSB7XG4gICAgICAgICAgY29uc3QgcGFnZUxpbWl0ID0gJGN0cmxVc2VyTGlzdC5wYWdlUGFyYW1zLmxpbWl0O1xuICAgICAgICAgIGNvbnN0IHBhZ2VPZmZzZXQgPSAkY3RybFVzZXJMaXN0LnBhZ2VQYXJhbXMub2Zmc2V0O1xuXG4gICAgICAgICAgJGN0cmxVc2VyTGlzdC51c2VycyA9IHJlc3AuZGF0YS5kYXRhO1xuICAgICAgICAgICRjdHJsVXNlckxpc3QuaXNMb2FkaW5nID0gZmFsc2U7XG5cbiAgICAgICAgICBjb25zdCB0b3RhbFBhZ2VzID0gTWF0aC5jZWlsKFxuICAgICAgICAgICAgcmVzcC5kYXRhLnJlY29yZHNUb3RhbCAvIHBhZ2VMaW1pdFxuICAgICAgICAgICk7XG5cbiAgICAgICAgICBjb25zdCBjdXJyZW50UGFnZSA9IHBhZ2VPZmZzZXQgLyBwYWdlTGltaXQgKyAxO1xuXG4gICAgICAgICAgJGN0cmxVc2VyTGlzdC5jdXJyZW50UGFnZSA9IGN1cnJlbnRQYWdlO1xuXG4gICAgICAgICAgJGN0cmxVc2VyTGlzdC5wYWdlcyA9IHBhZ2luYXRpb24oXG4gICAgICAgICAgICBjdXJyZW50UGFnZSxcbiAgICAgICAgICAgIHRvdGFsUGFnZXNcbiAgICAgICAgICApO1xuXG4gICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAkY3RybFVzZXJMaXN0LmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgfVxuXSk7IiwiY29uc3QgdXNlclRyYW5zYWN0aW9uc0N0cmwgPSBhbmd1bGFyLm1vZHVsZSgndXNlclRyYW5zYWN0aW9ucycsIFtcbiAgJ3VpLnJvdXRlcicsXG4gICd0cmFuc2FjdGlvbkxpc3QnXG5dKTtcblxudXNlclRyYW5zYWN0aW9uc0N0cmwuY29udHJvbGxlcignVXNlclRyYW5zYWN0aW9uc0N0cmwnLCBbXG4gICckc3RhdGVQYXJhbXMnLFxuICBmdW5jdGlvbiAoJHN0YXRlUGFyYW1zKSB7XG4gICAgY29uc3QgJGN0cmxVc2VyVHJhbnNhY3Rpb25zID0gdGhpcztcbiAgICAkY3RybFVzZXJUcmFuc2FjdGlvbnMuaWQgPSAkc3RhdGVQYXJhbXMuaWQ7XG4gIH1cbl0pO1xuIiwiYW5ndWxhci5tb2R1bGUoXG4gICdjb3JlLnVzZXInLFxuICBbJ2NvcmUtYXBpJ11cbik7XG5cblxuYW5ndWxhci5tb2R1bGUoJ2NvcmUudXNlcicpXG4gIC5mYWN0b3J5KCdVc2VycycsIFtcbiAgICAnYXBpJyxcbiAgICAnJGh0dHAnLFxuICAgIGZ1bmN0aW9uIChhcGksICRodHRwKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHBhcmFtcywgc3VjY2Vzc0NiID0gbnVsbCwgZXJyb3JDYiA9IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIGFwaSgkaHR0cCkuZ2V0KFxuICAgICAgICAgICcvdXNlcnMnLFxuICAgICAgICAgIHBhcmFtcyxcbiAgICAgICAgICBzdWNjZXNzQ2IsXG4gICAgICAgICAgZXJyb3JDYlxuICAgICAgICApO1xuICAgICAgfTtcbiAgICB9XG4gIF0pXG4gIC5mYWN0b3J5KCdPbmVVc2VyJywgW1xuICAgICdhcGknLFxuICAgICckaHR0cCcsXG4gICAgZnVuY3Rpb24gKGFwaSwgJGh0dHApIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoaWQsIHN1Y2Nlc3NDYiA9IG51bGwsIGVycm9yQ2IgPSBudWxsKSB7XG4gICAgICAgIHJldHVybiBhcGkoJGh0dHApLmdldChcbiAgICAgICAgICAnL3VzZXJzLycgKyBpZCxcbiAgICAgICAgICBudWxsLFxuICAgICAgICAgIHN1Y2Nlc3NDYixcbiAgICAgICAgICBlcnJvckNiXG4gICAgICAgICk7XG4gICAgICB9O1xuICAgIH1cbiAgXSlcbiAgLmZhY3RvcnkoJ1VwZGF0ZVVzZXInLCBbXG4gICAgJ2FwaScsXG4gICAgJyRodHRwJyxcbiAgICBmdW5jdGlvbiAoYXBpLCAkaHR0cCkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChpZCwgcGFyYW1zLCBzdWNjZXNzQ2IgPSBudWxsLCBlcnJvckNiID0gbnVsbCkge1xuICAgICAgICByZXR1cm4gYXBpKCRodHRwKS51cGRhdGUoXG4gICAgICAgICAgJy91c2Vycy8nICsgaWQsXG4gICAgICAgICAgcGFyYW1zLFxuICAgICAgICAgIHN1Y2Nlc3NDYixcbiAgICAgICAgICBlcnJvckNiXG4gICAgICAgICk7XG4gICAgICB9O1xuICAgIH1cbiAgXSlcbiAgLmZhY3RvcnkoJ0NyZWF0ZVVzZXInLCBbXG4gICAgJ2FwaScsXG4gICAgJyRodHRwJyxcbiAgICBmdW5jdGlvbiAoYXBpLCAkaHR0cCkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChwYXJhbXMsIHN1Y2Nlc3NDYiA9IG51bGwsIGVycm9yQ2IgPSBudWxsKSB7XG4gICAgICAgIHJldHVybiBhcGkoJGh0dHApLmNyZWF0ZShcbiAgICAgICAgICAnL3VzZXJzJyxcbiAgICAgICAgICBwYXJhbXMsXG4gICAgICAgICAgc3VjY2Vzc0NiLFxuICAgICAgICAgIGVycm9yQ2JcbiAgICAgICAgKTtcbiAgICAgIH07XG4gICAgfVxuICBdKVxuICAuZmFjdG9yeSgnTmV3UmVjaGFyZ2UnLCBbXG4gICAgJ2FwaScsXG4gICAgJyRodHRwJyxcbiAgICBmdW5jdGlvbiAoYXBpLCAkaHR0cCkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChpZCwgcGFyYW1zLCBzdWNjZXNzQ2IgPSBudWxsLCBlcnJvckNiID0gbnVsbCkge1xuICAgICAgICByZXR1cm4gYXBpKCRodHRwKS5jcmVhdGUoXG4gICAgICAgICAgJy91c2Vycy8nICsgaWQgKyAnL3JlY2hhcmdlJyxcbiAgICAgICAgICBwYXJhbXMsXG4gICAgICAgICAgc3VjY2Vzc0NiLFxuICAgICAgICAgIGVycm9yQ2JcbiAgICAgICAgKTtcbiAgICAgIH07XG4gICAgfVxuICBdKVxuICAuZmFjdG9yeSgnVXNlclRyYW5zYWN0aW9ucycsIFtcbiAgICAnYXBpJyxcbiAgICAnJGh0dHAnLFxuICAgIGZ1bmN0aW9uIChhcGksICRodHRwKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGlkLCBwYXJhbXMsIHN1Y2Nlc3NDYiA9IG51bGwsIGVycm9yQ2IgPSBudWxsKSB7XG4gICAgICAgIHJldHVybiBhcGkoJGh0dHApLmdldChcbiAgICAgICAgICAnL3VzZXJzLycgKyBpZCArICcvdHJhbnNhY3Rpb25zJyxcbiAgICAgICAgICBwYXJhbXMsXG4gICAgICAgICAgc3VjY2Vzc0NiLFxuICAgICAgICAgIGVycm9yQ2JcbiAgICAgICAgKTtcbiAgICAgIH07XG4gICAgfVxuICBdKTsiXX0=
